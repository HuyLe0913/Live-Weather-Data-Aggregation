apiVersion: batch/v1
kind: Job
metadata:
  name: weather-spark-streaming
  namespace: processing
spec:
  template:
    spec:
      containers:
      - name: spark-app
        image: weather-spark-app:latest
        env:
        - name: KAFKA_BOOTSTRAP_SERVERS
          value: "kafka.ingestion.svc.cluster.local:9092"
        - name: KAFKA_TOPIC
          value: "weather-data"
        - name: MINIO_ENDPOINT
          value: "http://minio.storage.svc.cluster.local:9000"
        - name: MINIO_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              name: minio-secret
              key: access-key
        - name: MINIO_SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: minio-secret
              key: secret-key
        - name: MONGODB_URI
          value: "mongodb://mongodb.storage.svc.cluster.local:27017"
        - name: HIVE_METASTORE_URI
          value: "thrift://hive-metastore.storage.svc.cluster.local:9083"
        resources:
          requests:
            memory: "2Gi"
            cpu: "1000m"
          limits:
            memory: "4Gi"
            cpu: "2000m"
      restartPolicy: OnFailure
---
apiVersion: v1
kind: Secret
metadata:
  name: minio-secret
  namespace: storage
type: Opaque
stringData:
  access-key: "rootuser"
  secret-key: "rootpass123"

